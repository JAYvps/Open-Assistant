# Open Assistant - 桌面AI助手

**Open Assistant** 是一个轻量级、以视觉和文本为核心的桌面AI助手项目。它通过一个悬浮球UI与用户交互，集成了强大的工具调用能力，旨在成为您在Windows桌面上的得力伙伴。

项目基于 `fastmcp` 框架构建，通过大型语言模型（LLM）驱动，可以理解自然语言指令，并执行如文件操作、网页浏览、信息查询、屏幕内容识别等多种复杂任务。

## 核心功能

*   **视觉理解**：独创的“拖拽截图”交互，通过在屏幕上画圈，即可让AI理解并分析选定区域的内容。
*   **工具调用**：能够操作本地应用（如Word, Excel）、控制浏览器、查询天气、管理文件等。
*   **上下文记忆**：支持多轮对话，能够理解上下文关联，进行连贯的交流。
*   **现代UI**：简洁的悬浮球设计，以及全新设计的“聊天气泡”式对话框。
*   **命令行驱动**：移除了GUI启动器，通过纯命令行即可完成配置和启动，干净利落。

---

## 快速上手

### 1. 环境配置

本项目在 `Python 3.11+` 和 `Windows` 操作系统下测试通过。

### 2. 安装依赖

在项目根目录下打开命令行（PowerShell 或 CMD），运行以下命令来安装所有必需的Python库：

```bash
pip install -r requirements.txt
```

### 3. 配置API密钥

本项目依赖阿里云和秘塔AI的API。您需要一个 `.env` 文件来存放密钥。

程序首次运行时会自动检测，如果发现您没有配置，它会**在命令行中交互式地提示您输入**。

您也可以随时通过以下命令来**强制更新**您的API密钥：

```bash
python mcp_agent_and_server_start.py --update-keys
```

程序会将您输入的密钥保存在项目根目录的 `.env` 文件中(当然，您也可以手动修改更新此文件)。

---

## 如何运行

现在，您需要一个命令启动整个应用。

在项目根目录下打开命令行，运行：

```bash
python mcp_agent_and_server_start.py
```

该命令会同时启动后端的工具服务和前端的悬浮球UI。您会在命令行看到服务器成功启动的日志，同时一个悬浮球会出现在您的桌面右侧。

## 如何使用

1.  **激活对话框**：鼠标悬停在悬浮球上，即可在其左侧或右侧看到输入框和对话框。
2.  **文本交互**：在输入框中输入您的问题或指令，然后按回车(10条左右的上下文记忆能力)。
3.  **视觉交互（截图提问）**：
    *   按住鼠标左键拖动悬浮球。
    *   在屏幕上画一个圈，圈住您想让AI看到的内容。
    *   松开鼠标，程序会自动截图并将图片附在您的下一次提问中。
    *   在输入框中输入您对该截图的问题（例如“总结一下这个图表”），然后按回车。
4.  **右键菜单**：右键点击悬浮球，可以找到“退出软件”的选项。

---

## 项目文件结构与功能说明

### 1. `mcp_agent_and_server_start.py`
**核心启动与控制脚本**。这是您运行整个应用的唯一入口。它的主要职责包括：
- **环境配置**：在启动时检查并管理`.env`文件中的API密钥，支持命令行交互。
- **服务启动**：在后台线程中启动 `server.py` 提供的工具服务（Tool Server）。
- **UI加载**：在另一个后台线程中启动 `float_ball_line.py` 描绘的前端悬浮球界面。
- **主循环**：维持一个主循环，监听并处理来自UI的指令，实现前后端通信。

### 2. `server.py`
**AI的“工具箱”**。这个文件定义了AI能使用的所有“技能”。每一个技能都被封装成一个独立的函数，并通过 `@mcp.tool()` 装饰器注册为AI可调用的工具。主要功能模块包括：
- **信息查询**：如查询天气、通过AI搜索引擎进行网页搜索。
- **文件处理**：如创建文件、将Markdown格式转换为Word或Excel。
- **系统交互**：如打开指定的应用程序、执行Windows系统快捷键、控制音乐播放。
- **视觉分析**：提供识别屏幕截图内容的能力。

### 3. `float_ball_line.py`
**前端UI实现文件**。所有您能看到的图形界面元素都在此定义。
- **悬浮球**：实现了悬浮球的拖动、停靠、动画效果和右键菜单。
- **截图交互**：包含了通过画圈来截取屏幕区域的核心功能。
- **对话界面**：使用PyQt5构建了现代化的“聊天气泡”式对话框和输入框。
- **通信**：负责将用户在UI上的操作（如输入文字、截图）发送给后端，并接收和展示后端返回的结果。

### 4. 核心能力模块 (部分示例)
- **`agent_vision.py`**: 提供图像识别能力，利用AI模型分析截图内容。
- **`read_webpage.py`**: 提供读取和解析网页内容的能力。
- **`write_file.py`**: 提供基础的文件写入能力，被 `server.py` 中的工具所调用。

## 许可证

本项目仅供个人学习和研究使用，它的代码也足够简单 放心玩耍。